-*- mode: outline; mode: flyspell -*-

* README - utils/bootstrap-early

This step prepares us for the bootstrap-cross step.  It installs some extra
necessary tools on the originating host system to ensure that we have
everything needed to complete the build.

All the packages built in this section will get compiled and installed in
$BUILDROOT/bootstrap-early.  Actually using them will require tweaking of
your user's environment (PATH, LD_LIBRARY_PATH, etc).

Note that this stage assumes the host system at least has git (to get this),
wget (to get other sources), autotools (to configure this), and a sane
compilation toolchain (make, gcc, glibc, etc).

Note also, that even though a sane compilation toolchain is listed as a
requirement, we're going to immediately test this by... bootstrapping and
installing our own GNU bootstrapping toolchain (autoconf, automake, libtool,
etc).  This way, we ensure that the versions of all the compile toolchain
components are adequate for compiling our bootstrap environment.

NOTE: There are cyclic dependencies that crop up when bootstrapping the
      toolchain (i.e., running bootstrap or autogen.sh from git checkouts).  The
      easiest way around this is to download and install the dist source tarball
      of automake (that matches the version we're tracking in our automake git
      submodule) on the host system (it's needed by m4 which is needed to
      bootstrap automake).

NOTE: The version of git might need to be fairly recent (submodule wasn't very
      good until around v1.6).

NOTE: The system's tar command will need to be able to transparently decrompress
      via gzip, bzip2, and xz (i.e., tar xf foo.tar.xz needs to work).  Some
      really old distros might not support xz yet.


FIXME: should i build rsync, tar, or wget in here?  rsync would need to be 1st,
       just in case any of the others can't build in-tree.  tar is going to need
       gzip bzip and xz compression built-in.  wget is needed up front, to do
       get_sources, which we need to do before bootstrap-early, so it doesn't
       make much sense to build it in here.  I'm leaning towards building rsync
       and tar (and perhaps gzip, bzip2, and xz) but not wget.

       Regarding tar, gzip, bzip2, and xz...  they have to ALL be in git,
       otherwise we'll need tar to build tar.  ;-)


* Need to always build
** e2fsprogs (make sure created rootfs doesn't use vendor extensions)
** make (ensure GNU build/bootstrap tools exist and are compatible)
** m4
** autoconf
** automake
** libtool
** pkg-config
** bison
** gettext
** gperf


* Might need (add configure check)
** help2man (needed for texinfo in bootstrap and for bootstrapping m4)
** rsync (need to be able to rsync source trees)
** tar (need -g incremental support, and xz support)
** xz (needed to build syslinux)

* Optional
** ncurses (needed for Kbuild's menuconfig)



* Bootstrap nightmare

Ok, I can't seem to get some of the git checkouts to bootstrap properly...
there's cyclic dependencies all over.  If I install the following from dist
tarballs:

  - autoconf-2.68.tar.bz2
  - automake-1.11.1.tar.bz2
  - bison-2.4.3.tar.bz2
  - gettext-0.18.1.1.tar.bz2
  - gperf-3.0.4.tar.bz2
  - libtool-2.4.tar.bz2
  - m4-1.4.15.tar.bz2
  - make-3.82.tar.bz2
  - pkg-config-0.25.tar.bz2

then I can successfully bootstrap the following source trees:

  - bison (bootstrap*)
  - m4 (bootstrap*)
  - automake (bootstrap)
  - libtool (bootstrap)
  - util-linux (autogen.sh)
  - gettext (autogen.sh*)

like this:

# ./autogen.sh

or like this:

# export toplevel=$PWD/../..
# GNULIB_SRCDIR=$toplevel/src/gnulib ./bootstrap


** automate it? bootsrap-early-bootstrap?

Use wget to snag all the appropriate tarballs, then iterate through the list
doing:

# ./configure && make -j$(JOBCOUNT) && \
    sudo make install && sudo ldconfig
