#!/bin/sh

PREFIX_EARLY=@PREFIX_EARLY@
export PATH=$PREFIX_EARLY/bin:$PREFIX_EARLY/sbin:$PATH
export MANPATH=$PREFIX_EARLY/man:$PREFIX_EARLY/share/man:$MANPATH
export PKG_CONFIG_PATH=$PREFIX_EARLY/lib/pkg-config:$PKG_CONFIG_PATH

if [ -z "$LD_LIBRARY_PATH" ]; then
    export LD_LIBRARY_PATH=$PREFIX_EARLY/lib;
else
    export LD_LIBRARY_PATH=$PREFIX_EARLY/lib:$LD_LIBRARY_PATH;
fi

PIDFILE=$PREFIX_EARLY/var/run/xenconsoled.pid
if [ ! -f $PIDFILE ]; then
    $PREFIX_EARLY/etc/rc.d/init.d/xencommons start
fi

if ! (xl list); then
    echo "ERROR: Xen not working"
    return
fi
echo ""

if (grep "@CLFS_DEV@\|@RUCKUS_DEV@" /proc/mounts); then
    echo ""
    echo "WARNING: Make sure both CLFS_DEV and RUCKUS_DEV (if configured) are"
    echo "         unmounted prior to starting the ruckus-builder virtual"
    echo "         machine."
    echo ""
    echo "         CLFS_DEV: @CLFS_DEV@"
    echo "         RUCKUS_DEV: @RUCKUS_DEV@"
    echo ""
fi

echo "Sart the ruckus-builder virtual machine like this:"
echo ""
echo "xl create -c $PREFIX_EARLY/etc/xen/ruckus-builder.cfg"
echo ""
echo "To exit the virtual machine, either issue a 'poweroff' command or press"
echo "Ctrl-] to break out of the console, then 'xl shutdown ruckus-builder'"
